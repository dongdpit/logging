input { 
   kafka { 
   codec => "json"  
   bootstrap_servers => "10.26.7.58:9092,10.26.7.59:9092,10.26.7.60:9092"
   topics => ["iislog7"]
   tags => "iislog7"
   }
   kafka {
   codec => "json" 
   bootstrap_servers => "10.26.7.58:9092,10.26.7.59:9092,10.26.7.60:9092"
   topics => ["iislog8"]
   tags => "iislog8"
   }
   kafka {
   bootstrap_servers => "10.26.7.58:9092,10.26.7.59:9092,10.26.7.60:9092"
   topics => ["log-aggregation"]
   tags => "log-aggregation"
   }
   kafka {
   bootstrap_servers => "10.26.7.58:9092,10.26.7.59:9092,10.26.7.60:9092"
   topics => ["log-audit"]
   tags => "log-audit"
   }
   kafka {
   bootstrap_servers => "10.26.7.58:9092,10.26.7.59:9092,10.26.7.60:9092"
   topics => ["log-tracing-distributed"]
   tags => "log-tracing-distributed"
   }
   kafka {
   bootstrap_servers => "10.26.7.58:9092,10.26.7.59:9092,10.26.7.60:9092"
   topics => ["log-tracking-exception"]
   tags => "log-tracking-exception"
   }
   kafka {
   bootstrap_servers => "10.26.7.58:9092,10.26.7.59:9092,10.26.7.60:9092"
   topics => ["log-deployment"]
   tags => "log-deployment"
   }
   kafka {
   codec => "json" 
   bootstrap_servers => "10.26.7.58:9092,10.26.7.59:9092,10.26.7.60:9092"
   topics => ["log-app"]
   tags => "log-app"
   }
   kafka {
   bootstrap_servers => "10.26.7.58:9092,10.26.7.59:9092,10.26.7.60:9092"
   topics => ["log-text"]
   tags => "log-text"
   }
}


filter{
if "iislog7" in [tags] {
grok {
match => ["message","%{DATE:date} %{TIME:time} %{WORD:s-sitename} %{IPORHOST:s-ip} %{WORD:cs-method} %{NOTSPACE:cs-uri-stem} %{NOTSPACE:cs-uri-query} %{NUMBER:s-port} %{NOTSPACE:cs-username} %{IPORHOST:c-ip} %{NOTSPACE:cs(User-Agent)} %{NOTSPACE:cs(Referer)} %{NUMBER:sc-status} %{NUMBER:sc-substatus} %{NUMBER:sc-win32-status} %{NUMBER:time-taken:int} %{IPORHOST:iis.access.remote_ip}"]
}
}
}

filter{
if "iislog8" in [tags] {
grok {
match => ["message","%{DATE:date} %{TIME:time} %{WORD:s-sitename} %{IPORHOST:s-ip} %{WORD:cs-method} %{NOTSPACE:cs-uri-stem} %{NOTSPACE:cs-uri-query} %{NUMBER:s-port} %{NOTSPACE:cs-username} %{IPORHOST:c-ip} HTTP/%{NUMBER:c-http-version} %{NOTSPACE:cs(User-Agent)} %{NOTSPACE:cs(Referer)} %{NOTSPACE:cs-host} %{NUMBER:sc-status} %{NUMBER:sc-substatus} %{NUMBER:sc-win32-status} %{NUMBER:sc-bytes:int} %{NUMBER:cs-bytes:int} %{NUMBER:time-taken:int}"]
}
}
}

#filter{
#if "log-text" in [tags] {
#grok {
#match => { "message" => ['%{DATE:date} %{SERVICENAME:serviceName} %{LOGLEVEL:logLevel} %{LOGGER:logger} %{MESSAGE:message}' ] }
#}
#}
#}

filter{
if "log-text" in [tags] {
grok {
match => { "message" => ["^(?<DateTime>[-\/:\\.\w\s]+)\|(?<ServiceName>\w+)\|(?<LogLevel>[A-Za-z]+)\|(?<Logger>[\w\.]+)\|(?<Message>.*)$" ] }
}
}
}


output {
   if "nginxlog" in [tags] {
     elasticsearch {
      hosts => ["10.26.7.55:9200","10.26.7.56:9200","10.26.7.57:9200"]
      user => "elastic"
      password => "fit@3011"
      index => "nginx-%{+yyyy.MM.dd}"
    }
   }
   if "iislog7" in [tags] {
      elasticsearch {
      hosts => ["10.26.7.55:9200","10.26.7.56:9200","10.26.7.57:9200"]
      user => "elastic"
      password => "fit@3011"
      index => "iis7-%{+yyyy.MM.dd}"
    }
    }
    if "iislog8" in [tags] {
      elasticsearch {
      hosts => ["10.26.7.55:9200","10.26.7.56:9200","10.26.7.57:9200"]
      user => "elastic"
      password => "fit@3011"
      index => "iislog8-%{+yyyy.MM.dd}"
    }
    }
   if "log-aggregation" in [tags] {
      elasticsearch {
      hosts => ["10.26.7.55:9200","10.26.7.56:9200","10.26.7.57:9200"]
      user => "elastic"
      password => "fit@3011"
      index => "log-aggregation-%{+yyyy.MM.dd}"
    }
    }   
    if "log-audit" in [tags] {
      elasticsearch {
      hosts => ["10.26.7.55:9200","10.26.7.56:9200","10.26.7.57:9200"]
      user => "elastic"
      password => "fit@3011"
      index => "log-audit-%{+yyyy.MM.dd}"
    }
    }
    if "log-tracing-distributed" in [tags] {
      elasticsearch {
      hosts => ["10.26.7.55:9200","10.26.7.56:9200","10.26.7.57:9200"]
      user => "elastic"
      password => "fit@3011"
      index => "log-tracing-distributed-%{+yyyy.MM.dd}"
    }
    }
    if "log-tracking-exception" in [tags] {
      elasticsearch {
      hosts => ["10.26.7.55:9200","10.26.7.56:9200","10.26.7.57:9200"]
      user => "elastic"
      password => "fit@3011"
      index => "log-tracking-exception-%{+yyyy.MM.dd}"
    }
    }
    if "log-deployment" in [tags] {
      elasticsearch {
      hosts => ["10.26.7.55:9200","10.26.7.56:9200","10.26.7.57:9200"]
      user => "elastic"
      password => "fit@3011"
      index => "log-deployment-%{+yyyy.MM.dd}"
    }
    }
    if "log-app" in [tags] {
      elasticsearch {
      hosts => ["10.26.7.55:9200","10.26.7.56:9200","10.26.7.57:9200"]
      user => "elastic"
      password => "fit@3011"
      index => "log-app-%{+yyyy.MM.dd}"
    }
    }
    if "log-text" in [tags] {
      elasticsearch {
      hosts => ["10.26.7.55:9200","10.26.7.56:9200","10.26.7.57:9200"]
      user => "elastic"
      password => "fit@3011"
      index => "log-text-%{+yyyy.MM.dd}"
    }
    }
}
